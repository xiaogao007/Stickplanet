# 云函数部署指南

## 部署步骤

### 方法一：使用微信开发者工具（推荐）

1. **打开微信开发者工具**
   - 打开项目
   - 确保已登录并开通云开发

2. **部署单个云函数**
   - 在左侧文件树中，找到 `cloudfunctions` 目录
   - 右键点击要部署的云函数目录（如 `wechatLogin`）
   - 选择"上传并部署：云端安装依赖"
   - 等待部署完成

3. **部署所有云函数**
   - 可以逐个部署每个云函数
   - 或者使用批量部署功能（如果有）

### 方法二：使用命令行（如果支持）

```bash
# 进入云函数目录
cd cloudfunctions/wechatLogin

# 安装依赖
npm install

# 然后通过微信开发者工具上传
```

## 需要部署的云函数列表

请确保以下云函数都已部署：

- ✅ `wechatLogin` - 微信登录（**必须首先部署**）
- ✅ `getProfile` - 获取用户资料
- ✅ `getUserPlans` - 获取用户计划列表
- ✅ `getTemplates` - 获取推荐计划模板
- ✅ `getPlanById` - 获取计划详情
- ✅ `createPlan` - 创建计划
- ✅ `createCheckIn` - 创建打卡记录
- ✅ `getCheckInsByPlan` - 获取计划的打卡记录
- ✅ `getUserCheckInsForMonth` - 获取用户月度打卡记录
- ✅ `getUserAchievements` - 获取用户成就列表

## 验证部署

部署完成后，可以在微信开发者工具的"云开发"控制台中：
1. 进入"云函数"页面
2. 查看已部署的云函数列表
3. 确认所有云函数状态为"正常"

## 常见问题

### 1. 云函数找不到（FUNCTION_NOT_FOUND）
- **原因**：云函数未部署或部署失败
- **解决**：重新部署云函数，确保部署成功

### 2. 依赖安装失败
- **原因**：网络问题或 package.json 配置错误
- **解决**：检查网络连接，确保 package.json 格式正确

### 3. 云函数执行超时
- **原因**：云函数执行时间过长
- **解决**：优化云函数代码，减少执行时间

## 注意事项

1. **首次部署**：首次部署云函数时，需要等待依赖安装完成
2. **更新代码**：修改云函数代码后，需要重新部署才能生效
3. **环境变量**：云函数使用 `cloud.DYNAMIC_CURRENT_ENV` 自动获取当前环境
4. **权限设置**：确保云函数有访问数据库和存储的权限

