# 坚持打卡小程序 - 需求文档

## 1. 项目概述

### 1.1 项目背景
基于现有 UniApp 项目架构，开发一款坚持打卡小程序，帮助用户通过模板化创建、数据驱动优化和社交激励等方式，更好地坚持完成目标。

### 1.2 项目目标
- 提供丰富的打卡模板，降低用户创建目标的门槛
- 支持模板选择和完全自定义两种创建模式
- 通过数据分析持续优化模板库
- 通过社交功能增强用户粘性和坚持动力

### 1.3 目标用户
- 有自我提升需求的个人用户
- 需要坚持习惯养成的用户
- 喜欢分享和互动的社交型用户

---

## 2. 技术架构

### 2.1 技术栈

#### 核心框架
- **UniApp** - 跨平台开发框架
- **Vue 3** - 前端框架（使用 Composition API）
- **TypeScript** - 类型系统
- **微信云开发（CloudBase）** - 后端运行环境、云函数、数据库、云存储

#### 状态管理
- **Pinia** (替代 Vuex) - Vue 3 推荐的状态管理库
- 或 **Vuex 4.x** - 兼容 Vue 3 的版本

#### UI 组件库
- **uView Plus** (Vue 3 版本) 或 **uView UI 3.x**
- 如无 Vue 3 版本，考虑 **uni-ui** 或其他 Vue 3 兼容组件库

#### 构建工具与配置
- **Vue CLI 5.x** 或 **Vite** (推荐，Vue 3 官方推荐)
- **Webpack** / **Vite** - 打包工具
- **Babel** - JavaScript 编译器
- **PostCSS** - CSS 后处理器
- **Sass/SCSS** - CSS 预处理器

#### 工具库
- **lodash** - 工具函数库
- **dayjs** - 日期处理库（替代 moment.js）
- **core-js** - JavaScript 标准库 polyfill

#### 开发工具
- **cross-env** - 跨平台环境变量设置
- **vconsole** - 移动端调试工具

### 2.2 项目结构

```
src/
├── api/                    # API 接口
│   ├── template.ts        # 模板相关接口
│   ├── challenge.ts       # 打卡挑战相关接口
│   ├── user.ts            # 用户相关接口
│   └── social.ts          # 社交相关接口
├── assets/                # 静态资源
│   ├── images/           # 图片资源
│   ├── fonts/            # 字体文件
│   ├── common.scss       # 公共样式
│   └── variable.scss     # 样式变量
├── components/            # 公共组件
│   ├── ChallengeCard.vue # 打卡卡片组件
│   ├── TemplateCard.vue  # 模板卡片组件
│   ├── ProgressRing.vue  # 进度环形图组件
│   ├── ShareModal.vue    # 分享弹窗组件
│   └── CommentList.vue   # 评论列表组件
├── config/               # 配置文件
│   ├── index.ts          # 基础配置
│   └── api.ts            # API 配置
├── enums/                # 枚举定义
│   ├── ChallengeStatus.ts
│   ├── TemplateType.ts
│   └── Method.ts
├── model/                # 数据模型
│   ├── Challenge.ts      # 打卡挑战模型
│   ├── Template.ts       # 模板模型
│   ├── User.ts           # 用户模型
│   ├── Comment.ts        # 评论模型
│   └── Result.ts         # 统一响应模型
├── pages/                # 页面
│   ├── index/            # 首页
│   │   └── index.vue
│   ├── challenge/        # 打卡相关页面
│   │   ├── create.vue    # 创建打卡（模板选择/自定义）
│   │   ├── detail.vue    # 打卡详情
│   │   ├── record.vue    # 打卡记录
│   │   └── list.vue      # 我的打卡列表
│   ├── template/         # 模板相关页面
│   │   ├── list.vue      # 模板列表
│   │   └── detail.vue    # 模板详情
│   ├── social/           # 社交相关页面
│   │   ├── feed.vue      # 动态广场
│   │   ├── detail.vue    # 动态详情
│   │   └── user.vue      # 用户主页
│   └── mine/             # 我的
│       └── index.vue
├── store/                # 状态管理
│   ├── index.ts          # Store 入口
│   └── modules/
│       ├── challenge.ts  # 打卡状态管理
│       ├── template.ts   # 模板状态管理
│       ├── user.ts       # 用户状态管理
│       └── social.ts     # 社交状态管理
├── utils/                # 工具函数
│   ├── request.ts        # 请求封装
│   ├── common.ts         # 通用工具
│   ├── date.ts           # 日期工具
│   └── share.ts          # 分享工具
├── App.vue               # 应用入口
├── main.ts               # 主入口文件
├── manifest.json         # 应用配置
└── pages.json            # 页面配置
```

### 2.3 云开发部署形态

- **云函数网关**：统一的 `stickplanet-gateway` 云函数，用于接收前端请求（URL、Method、Body、Headers），在云端路由到具体业务逻辑/集合操作。
- **数据库**：使用云开发数据库集合（`users`、`templates`、`challenges`、`records`、`feeds` 等）存储业务数据，并结合安全规则控制访问权限。
- **鉴权流程**：
  1. 前端调用 `wx.cloud.callFunction({ name: 'login' })` 获取 `openid`/`unionid`，云端返回自定义 Session（可选）。
  2. 前端 Pinia `userStore` 维护 session/token，并在后续请求中由云函数侧通过 `context.OPENID` 校验身份。
- **文件存储**：打卡图片、分享海报等上传到云存储（`cloudPath`），返回 fileID 供前端展示。
- **运维**：通过 `wx cloud` CLI 上传云函数与数据库 schema，开启云托管定时任务做数据统计。
```

---

## 3. 功能需求详细说明

### 3.1 模板化创建打卡

#### 3.1.1 模板分类
- **健康类**：早起、运动、喝水、早睡、冥想等
- **学习类**：读书、背单词、学习技能、写日记等
- **工作类**：专注时间、完成任务、复盘总结等
- **生活类**：整理房间、做饭、陪伴家人等
- **兴趣类**：画画、练字、摄影、音乐等

#### 3.1.2 模板属性
每个模板包含以下信息：
- 模板ID
- 模板名称
- 模板图标/封面图
- 模板分类
- 模板描述
- 推荐打卡频率（每日/每周N次）
- 推荐打卡时长（7天/21天/30天/自定义）
- 打卡提醒时间（可选）
- 打卡方式（文字/图片/数字/位置等）
- 使用人数
- 完成率
- 平均坚持天数
- 标签（热门/推荐/新上架等）

#### 3.1.3 模板推荐算法
- 基于用户画像推荐（新用户推荐热门模板）
- 基于使用数据推荐（完成率高、坚持天数长的模板优先）
- 基于分类推荐（用户常使用的分类）
- 个性化推荐（基于用户历史行为）

### 3.2 双模式创建打卡

#### 3.2.1 模板选择模式
**流程：**
1. 进入创建页面，默认显示模板选择模式
2. 展示模板分类和推荐模板
3. 用户选择模板后，进入模板详情预览
4. 可自定义部分参数（打卡频率、时长、提醒时间等）
5. 确认创建打卡挑战

**可自定义项：**
- 打卡频率（每日/每周N次）
- 打卡时长（7/14/21/30/60/90天或自定义）
- 打卡提醒时间（多个时间段）
- 打卡方式（根据模板支持的方式选择）
- 挑战名称（可修改模板默认名称）
- 挑战描述（可修改模板默认描述）
- 是否公开（公开/仅自己可见）

#### 3.2.2 完全自定义模式
**流程：**
1. 点击"自定义创建"按钮
2. 填写基本信息：
   - 挑战名称（必填）
   - 挑战描述（可选）
   - 挑战图标/封面（可选，提供图标库选择）
3. 设置打卡规则：
   - 打卡频率（每日/每周N次/每月N次）
   - 打卡时长（天数）
   - 打卡方式（文字/图片/数字/位置/语音等，可多选）
4. 设置提醒：
   - 提醒时间（可设置多个）
   - 提醒文案（自定义）
5. 设置可见性：
   - 公开/仅自己可见
6. 确认创建

**自定义模式特点：**
- 完全自由，不受模板限制
- 支持多种打卡方式组合
- 可保存为个人模板（供下次使用）

### 3.3 数据驱动优化模板库

#### 3.3.1 数据收集
收集以下数据用于分析：
- 模板使用次数
- 模板完成率（完成挑战的用户数/创建挑战的用户数）
- 平均坚持天数
- 用户反馈（点赞、收藏、评论）
- 用户放弃原因（可选收集）
- 模板使用趋势（时间维度）

#### 3.3.2 数据分析
- **模板质量评估**：
  - 完成率 > 60%：优质模板
  - 完成率 40%-60%：良好模板
  - 完成率 < 40%：待优化模板
- **用户行为分析**：
  - 哪些模板最受欢迎
  - 哪些模板坚持时间最长
  - 用户放弃的高峰期
- **模板优化建议**：
  - 自动标记低质量模板
  - 推荐优化方向
  - 生成模板使用报告

#### 3.3.3 模板优化机制
- **自动下架**：完成率持续低于30%的模板自动下架
- **自动推荐**：完成率高、坚持天数长的模板自动推荐
- **模板迭代**：根据用户反馈优化模板描述、打卡方式等
- **新模板孵化**：基于用户自定义创建的热门挑战，孵化为新模板

### 3.4 社交激励功能

#### 3.4.1 内容分享
**分享内容：**
- 打卡记录（文字+图片）
- 打卡成就（连续打卡天数、完成挑战等）
- 打卡统计（打卡日历、数据统计）

**分享方式：**
- 生成精美分享图片（带二维码）
- 分享到微信好友/群
- 分享到朋友圈
- 分享到动态广场

**分享图片设计：**
- 打卡记录图片
- 打卡成就海报
- 数据统计图表
- 个性化文案

#### 3.4.2 动态广场
**功能：**
- 浏览其他用户的打卡动态
- 发布打卡动态（文字+图片）
- 点赞、评论、转发
- 关注用户
- 热门动态推荐
- 同挑战动态聚合

**动态类型：**
- 打卡记录动态
- 完成挑战动态
- 坚持成就动态
- 心得分享动态

**推荐算法：**
- 热门动态（点赞、评论数）
- 关注用户动态
- 同挑战用户动态
- 个性化推荐

#### 3.4.3 互动功能
**点赞：**
- 对打卡记录、动态、评论点赞
- 点赞通知

**评论：**
- 对打卡记录、动态评论
- 评论回复
- 评论通知

**关注：**
- 关注其他用户
- 粉丝列表
- 关注列表
- 互相关注标识

**挑战互动：**
- 加入同挑战群组（可选）
- 查看同挑战用户列表
- 挑战排行榜（连续打卡天数、总打卡次数等）

#### 3.4.4 激励机制
**成就系统：**
- 连续打卡成就（3天、7天、21天、30天、100天等）
- 完成挑战成就
- 分享成就
- 互动成就（获得点赞、评论等）

**排行榜：**
- 连续打卡排行榜
- 总打卡次数排行榜
- 挑战完成排行榜
- 互动排行榜（获赞数等）

**徽章系统：**
- 各类成就徽章
- 特殊活动徽章
- 徽章展示页

---

## 4. 页面结构设计

### 4.1 页面路由配置

```json
{
  "pages": [
    {
      "path": "pages/index/index",
      "style": {
        "navigationStyle": "custom"
      }
    },
    {
      "path": "pages/mine/index",
      "style": {
        "navigationStyle": "custom"
      }
    }
  ],
  "subPackages": [
    {
      "root": "pages/challenge",
      "pages": [
        {
          "path": "create/index",
          "style": {
            "navigationBarTitleText": "创建打卡"
          }
        },
        {
          "path": "detail/index",
          "style": {
            "navigationBarTitleText": "打卡详情"
          }
        },
        {
          "path": "record/index",
          "style": {
            "navigationBarTitleText": "打卡记录"
          }
        },
        {
          "path": "list/index",
          "style": {
            "navigationBarTitleText": "我的打卡"
          }
        }
      ]
    },
    {
      "root": "pages/template",
      "pages": [
        {
          "path": "list/index",
          "style": {
            "navigationBarTitleText": "模板库"
          }
        },
        {
          "path": "detail/index",
          "style": {
            "navigationBarTitleText": "模板详情"
          }
        }
      ]
    },
    {
      "root": "pages/social",
      "pages": [
        {
          "path": "feed/index",
          "style": {
            "navigationBarTitleText": "动态广场"
          }
        },
        {
          "path": "detail/index",
          "style": {
            "navigationBarTitleText": "动态详情"
          }
        },
        {
          "path": "user/index",
          "style": {
            "navigationBarTitleText": "用户主页"
          }
        }
      ]
    }
  ],
  "tabBar": {
    "color": "#7A7E83",
    "selectedColor": "#3cc51f",
    "borderStyle": "black",
    "backgroundColor": "#ffffff",
    "list": [
      {
        "pagePath": "pages/index/index",
        "iconPath": "static/tab/home1.png",
        "selectedIconPath": "static/tab/home_pink.png",
        "text": "首页"
      },
      {
        "pagePath": "pages/social/feed/index",
        "iconPath": "static/tab/feed1.png",
        "selectedIconPath": "static/tab/feed_pink.png",
        "text": "广场"
      },
      {
        "pagePath": "pages/mine/index",
        "iconPath": "static/tab/profile1.png",
        "selectedIconPath": "static/tab/profile_pink.png",
        "text": "我的"
      }
    ]
  }
}
```

### 4.2 页面功能说明

#### 4.2.1 首页 (pages/index/index)
**功能：**
- 今日打卡提醒（未完成的打卡）
- 我的打卡列表（进行中、已完成、已放弃）
- 快速创建打卡按钮
- 推荐模板入口
- 统计数据展示（总打卡天数、连续打卡天数等）

#### 4.2.2 创建打卡页 (pages/challenge/create)
**功能：**
- 双模式切换（模板选择/自定义创建）
- 模板选择模式：
  - 模板分类筛选
  - 模板列表展示
  - 模板搜索
  - 模板详情预览
- 自定义创建模式：
  - 表单填写
  - 规则设置
  - 预览确认

#### 4.2.3 打卡详情页 (pages/challenge/detail)
**功能：**
- 挑战基本信息展示
- 打卡日历（已打卡日期标记）
- 打卡记录列表
- 统计数据（连续天数、总天数、完成率等）
- 打卡操作（文字/图片/数字等）
- 分享功能
- 同挑战用户列表

#### 4.2.4 打卡记录页 (pages/challenge/record)
**功能：**
- 打卡记录列表（时间倒序）
- 记录详情（文字、图片、时间等）
- 记录编辑/删除
- 记录分享

#### 4.2.5 我的打卡列表 (pages/challenge/list)
**功能：**
- 打卡分类（进行中/已完成/已放弃）
- 打卡卡片列表
- 打卡操作（继续/放弃/删除/分享）

#### 4.2.6 模板列表页 (pages/template/list)
**功能：**
- 模板分类导航
- 模板列表（支持排序：热门/最新/完成率）
- 模板搜索
- 模板筛选

#### 4.2.7 模板详情页 (pages/template/detail)
**功能：**
- 模板详细信息
- 模板预览
- 使用数据展示（使用人数、完成率等）
- 一键创建打卡
- 收藏模板

#### 4.2.8 动态广场 (pages/social/feed)
**功能：**
- 动态列表（支持排序：最新/热门）
- 动态类型筛选
- 发布动态入口
- 点赞、评论、分享
- 下拉刷新、上拉加载

#### 4.2.9 动态详情页 (pages/social/detail)
**功能：**
- 动态完整内容
- 评论列表
- 点赞列表
- 评论、点赞操作
- 分享功能

#### 4.2.10 用户主页 (pages/social/user)
**功能：**
- 用户基本信息
- 用户统计数据
- 用户动态列表
- 用户打卡列表
- 关注/取消关注

#### 4.2.11 我的页面 (pages/mine/index)
**功能：**
- 用户信息展示
- 统计数据（总打卡天数、连续天数、完成挑战数等）
- 功能入口：
  - 我的打卡
  - 我的动态
  - 我的收藏（模板）
  - 我的关注/粉丝
  - 我的成就/徽章
  - 设置

---

## 5. 数据结构设计

### 5.1 数据模型

#### 5.1.1 用户模型 (User)
```typescript
interface User {
  id: string;                    // 用户ID
  openid: string;                // 微信openid
  nickname: string;              // 昵称
  avatar: string;                // 头像
  gender: number;                // 性别 0-未知 1-男 2-女
  createTime: string;            // 注册时间
  lastLoginTime: string;         // 最后登录时间
  // 统计数据
  totalChallengeDays: number;    // 总打卡天数
  currentStreak: number;         // 当前连续打卡天数
  longestStreak: number;         // 最长连续打卡天数
  completedChallenges: number;   // 完成挑战数
  followers: number;             // 粉丝数
  following: number;             // 关注数
}
```

#### 5.1.2 模板模型 (Template)
```typescript
interface Template {
  id: string;                    // 模板ID
  name: string;                  // 模板名称
  icon: string;                  // 图标
  cover: string;                 // 封面图
  category: string;              // 分类
  description: string;           // 描述
  // 推荐设置
  recommendedFrequency: string;  // 推荐频率 "daily" | "weekly" | "custom"
  recommendedDuration: number;   // 推荐时长（天）
  recommendedReminderTime?: string[]; // 推荐提醒时间
  checkInTypes: CheckInType[];   // 支持的打卡方式
  // 标签
  tags: string[];                // 标签 ["热门", "推荐", "新上架"]
  // 统计数据
  useCount: number;              // 使用人数
  completionRate: number;        // 完成率
  avgStreakDays: number;         // 平均坚持天数
  // 状态
  status: "active" | "inactive"; // 状态
  createTime: string;            // 创建时间
  updateTime: string;            // 更新时间
}

enum CheckInType {
  TEXT = "text",           // 文字
  IMAGE = "image",         // 图片
  NUMBER = "number",       // 数字
  LOCATION = "location",   // 位置
  VOICE = "voice"          // 语音
}
```

#### 5.1.3 打卡挑战模型 (Challenge)
```typescript
interface Challenge {
  id: string;                    // 挑战ID
  userId: string;                // 用户ID
  templateId?: string;           // 模板ID（如果来自模板）
  name: string;                  // 挑战名称
  description?: string;          // 挑战描述
  icon?: string;                 // 图标
  cover?: string;                // 封面图
  // 打卡规则
  frequency: string;             // 频率 "daily" | "weekly" | "monthly" | "custom"
  frequencyValue?: number;       // 频率值（每周N次）
  duration: number;              // 时长（天）
  checkInTypes: CheckInType[];   // 打卡方式
  // 提醒设置
  reminderTimes?: string[];      // 提醒时间 ["09:00", "21:00"]
  reminderText?: string;         // 提醒文案
  // 时间
  startDate: string;             // 开始日期
  endDate: string;               // 结束日期
  // 状态
  status: ChallengeStatus;       // 状态
  // 统计数据
  totalDays: number;             // 总天数
  checkInDays: number;           // 已打卡天数
  currentStreak: number;         // 当前连续天数
  longestStreak: number;         // 最长连续天数
  completionRate: number;        // 完成率
  // 可见性
  isPublic: boolean;             // 是否公开
  // 时间戳
  createTime: string;
  updateTime: string;
}

enum ChallengeStatus {
  ONGOING = "ongoing",           // 进行中
  COMPLETED = "completed",       // 已完成
  ABANDONED = "abandoned"        // 已放弃
}
```

#### 5.1.4 打卡记录模型 (CheckInRecord)
```typescript
interface CheckInRecord {
  id: string;                    // 记录ID
  challengeId: string;           // 挑战ID
  userId: string;                // 用户ID
  // 打卡内容
  checkInType: CheckInType;      // 打卡方式
  content?: string;              // 文字内容
  images?: string[];             // 图片列表
  number?: number;               // 数字值
  location?: {                   // 位置信息
    name: string;
    latitude: number;
    longitude: number;
  };
  voice?: string;                // 语音URL
  // 时间
  checkInDate: string;           // 打卡日期 YYYY-MM-DD
  checkInTime: string;           // 打卡时间 YYYY-MM-DD HH:mm:ss
  // 社交
  isShared: boolean;             // 是否分享到广场
  likeCount: number;             // 点赞数
  commentCount: number;          // 评论数
  // 时间戳
  createTime: string;
  updateTime: string;
}
```

#### 5.1.5 动态模型 (Feed)
```typescript
interface Feed {
  id: string;                    // 动态ID
  userId: string;                // 用户ID
  user: User;                    // 用户信息
  type: FeedType;                // 动态类型
  challengeId?: string;          // 关联挑战ID
  checkInRecordId?: string;      // 关联打卡记录ID
  // 内容
  content: string;               // 文字内容
  images?: string[];             // 图片列表
  // 互动数据
  likeCount: number;             // 点赞数
  commentCount: number;          // 评论数
  shareCount: number;            // 分享数
  isLiked: boolean;              // 当前用户是否点赞
  // 时间
  createTime: string;
  updateTime: string;
}

enum FeedType {
  CHECK_IN = "check_in",         // 打卡记录
  CHALLENGE_COMPLETED = "challenge_completed", // 完成挑战
  ACHIEVEMENT = "achievement",   // 成就
  SHARE = "share"                // 分享
}
```

#### 5.1.6 评论模型 (Comment)
```typescript
interface Comment {
  id: string;                    // 评论ID
  feedId: string;                // 动态ID
  userId: string;                // 用户ID
  user: User;                    // 用户信息
  content: string;               // 评论内容
  replyTo?: string;              // 回复的评论ID
  replyToUser?: User;            // 回复的用户
  likeCount: number;             // 点赞数
  isLiked: boolean;              // 当前用户是否点赞
  createTime: string;
  updateTime: string;
}
```

#### 5.1.7 成就模型 (Achievement)
```typescript
interface Achievement {
  id: string;                    // 成就ID
  name: string;                  // 成就名称
  description: string;           // 成就描述
  icon: string;                  // 图标
  badge: string;                 // 徽章图片
  type: AchievementType;         // 成就类型
  condition: any;                // 达成条件
  rarity: "common" | "rare" | "epic" | "legendary"; // 稀有度
}

enum AchievementType {
  STREAK = "streak",             // 连续打卡
  TOTAL_DAYS = "total_days",     // 总打卡天数
  CHALLENGE_COMPLETED = "challenge_completed", // 完成挑战
  SOCIAL = "social"              // 社交成就
}
```

### 5.2 统一响应模型
```typescript
interface Result<T> {
  code: number;                  // 状态码 200-成功
  message: string;               // 消息
  data: T;                       // 数据
  timestamp: number;             // 时间戳
}
```

---

## 6. 接口设计

> **云开发说明**：所有前端接口均通过微信云函数网关（`wx.cloud.callFunction`）访问，由云端根据 `url`/`method` 分发至对应服务。下列 RESTful 定义保持不变，仅作为云函数内部路由规范。

### 6.1 模板相关接口

#### 6.1.1 获取模板列表
```
GET /api/template/list
参数:
  - category?: string        // 分类
  - keyword?: string         // 关键词
  - sort?: string           // 排序方式 "hot" | "new" | "completion"
  - page: number            // 页码
  - pageSize: number        // 每页数量

响应:
{
  code: 200,
  data: {
    list: Template[],
    total: number,
    page: number,
    pageSize: number
  }
}
```

#### 6.1.2 获取模板详情
```
GET /api/template/:id

响应:
{
  code: 200,
  data: Template
}
```

#### 6.1.3 收藏/取消收藏模板
```
POST /api/template/:id/favorite
DELETE /api/template/:id/favorite

响应:
{
  code: 200,
  message: "操作成功"
}
```

### 6.2 打卡挑战相关接口

#### 6.2.1 创建打卡挑战
```
POST /api/challenge/create
Body:
{
  templateId?: string,      // 模板ID（可选）
  name: string,             // 挑战名称
  description?: string,     // 描述
  frequency: string,        // 频率
  frequencyValue?: number,  // 频率值
  duration: number,         // 时长
  checkInTypes: string[],   // 打卡方式
  reminderTimes?: string[], // 提醒时间
  reminderText?: string,    // 提醒文案
  isPublic: boolean         // 是否公开
}

响应:
{
  code: 200,
  data: Challenge
}
```

#### 6.2.2 获取我的打卡列表
```
GET /api/challenge/my-list
参数:
  - status?: string         // 状态 "ongoing" | "completed" | "abandoned"
  - page: number
  - pageSize: number

响应:
{
  code: 200,
  data: {
    list: Challenge[],
    total: number
  }
}
```

#### 6.2.3 获取打卡详情
```
GET /api/challenge/:id

响应:
{
  code: 200,
  data: Challenge
}
```

#### 6.2.4 放弃打卡挑战
```
POST /api/challenge/:id/abandon

响应:
{
  code: 200,
  message: "操作成功"
}
```

#### 6.2.5 删除打卡挑战
```
DELETE /api/challenge/:id

响应:
{
  code: 200,
  message: "删除成功"
}
```

### 6.3 打卡记录相关接口

#### 6.3.1 提交打卡记录
```
POST /api/check-in/create
Body:
{
  challengeId: string,      // 挑战ID
  checkInType: string,      // 打卡方式
  content?: string,         // 文字内容
  images?: string[],        // 图片列表
  number?: number,          // 数字值
  location?: {              // 位置
    name: string,
    latitude: number,
    longitude: number
  },
  voice?: string,           // 语音URL
  checkInDate: string,      // 打卡日期 YYYY-MM-DD
  isShared: boolean         // 是否分享到广场
}

响应:
{
  code: 200,
  data: CheckInRecord
}
```

#### 6.3.2 获取打卡记录列表
```
GET /api/check-in/list
参数:
  - challengeId: string     // 挑战ID
  - page: number
  - pageSize: number

响应:
{
  code: 200,
  data: {
    list: CheckInRecord[],
    total: number
  }
}
```

#### 6.3.3 删除打卡记录
```
DELETE /api/check-in/:id

响应:
{
  code: 200,
  message: "删除成功"
}
```

### 6.4 社交相关接口

#### 6.4.1 获取动态列表
```
GET /api/feed/list
参数:
  - type?: string           // 动态类型
  - sort?: string          // 排序 "latest" | "hot"
  - page: number
  - pageSize: number

响应:
{
  code: 200,
  data: {
    list: Feed[],
    total: number
  }
}
```

#### 6.4.2 发布动态
```
POST /api/feed/create
Body:
{
  type: string,             // 动态类型
  challengeId?: string,     // 关联挑战ID
  checkInRecordId?: string, // 关联打卡记录ID
  content: string,          // 内容
  images?: string[]         // 图片列表
}

响应:
{
  code: 200,
  data: Feed
}
```

#### 6.4.3 点赞/取消点赞
```
POST /api/feed/:id/like
DELETE /api/feed/:id/like

响应:
{
  code: 200,
  message: "操作成功"
}
```

#### 6.4.4 评论
```
POST /api/feed/:id/comment
Body:
{
  content: string,          // 评论内容
  replyTo?: string         // 回复的评论ID
}

响应:
{
  code: 200,
  data: Comment
}
```

#### 6.4.5 获取评论列表
```
GET /api/feed/:id/comments
参数:
  - page: number
  - pageSize: number

响应:
{
  code: 200,
  data: {
    list: Comment[],
    total: number
  }
}
```

#### 6.4.6 关注/取消关注
```
POST /api/user/:id/follow
DELETE /api/user/:id/follow

响应:
{
  code: 200,
  message: "操作成功"
}
```

### 6.5 用户相关接口

#### 6.5.1 获取用户信息
```
GET /api/user/info

响应:
{
  code: 200,
  data: User
}
```

#### 6.5.2 更新用户信息
```
PUT /api/user/info
Body:
{
  nickname?: string,
  avatar?: string,
  gender?: number
}

响应:
{
  code: 200,
  data: User
}
```

#### 6.5.3 获取用户统计数据
```
GET /api/user/statistics

响应:
{
  code: 200,
  data: {
    totalChallengeDays: number,
    currentStreak: number,
    longestStreak: number,
    completedChallenges: number,
    followers: number,
    following: number
  }
}
```

### 6.6 数据统计接口（用于模板优化）

#### 6.6.1 获取模板使用数据
```
GET /api/template/:id/statistics

响应:
{
  code: 200,
  data: {
    useCount: number,
    completionRate: number,
    avgStreakDays: number,
    trendData: Array<{date: string, count: number}>
  }
}
```

---

## 7. UI/UX 设计要点

### 7.1 设计原则
- **简洁明了**：界面简洁，信息层次清晰
- **激励性强**：通过视觉反馈增强用户成就感
- **社交友好**：分享和互动功能易于使用
- **个性化**：支持自定义，满足不同用户需求

### 7.2 关键页面设计

#### 7.2.1 首页设计
- 顶部：用户头像、统计数据（连续天数、总天数）
- 今日打卡提醒卡片（未完成的打卡）
- 我的打卡列表（卡片式展示）
- 快速创建按钮（悬浮按钮）
- 推荐模板入口

#### 7.2.2 创建打卡页设计
- 顶部：模式切换（模板选择/自定义创建）
- 模板选择模式：
  - 分类导航（横向滚动）
  - 模板网格列表
  - 搜索框
- 自定义创建模式：
  - 步骤指示器
  - 表单填写
  - 预览区域

#### 7.2.3 打卡详情页设计
- 顶部：挑战信息卡片（名称、图标、进度）
- 打卡日历（月份视图，已打卡日期高亮）
- 统计数据卡片（连续天数、总天数、完成率）
- 打卡操作区域（根据打卡方式显示不同输入）
- 打卡记录列表

#### 7.2.4 动态广场设计
- 顶部：发布动态按钮
- 动态列表（卡片式，支持图片预览）
- 互动按钮（点赞、评论、分享）
- 下拉刷新、上拉加载

### 7.3 视觉元素

#### 7.3.1 颜色方案
- 主色调：绿色系（代表坚持、成长）
- 辅助色：橙色（激励）、蓝色（信任）
- 背景色：浅灰色、白色
- 文字色：深灰色、黑色

#### 7.3.2 图标设计
- 统一的图标风格
- 清晰的语义表达
- 适当的视觉重量

#### 7.3.3 动画效果
- 打卡成功动画（庆祝效果）
- 进度更新动画
- 页面切换动画
- 加载动画

---

## 8. 开发计划

### 8.1 开发阶段

#### 第一阶段：基础功能（2-3周）
- [ ] 项目初始化（Vue 3 + UniApp + TypeScript）
- [ ] 基础架构搭建（路由、状态管理、请求封装）
- [ ] 用户登录/授权
- [ ] 模板列表/详情页
- [ ] 创建打卡功能（模板选择模式）
- [ ] 打卡详情页
- [ ] 打卡记录提交
- [ ] 我的打卡列表

#### 第二阶段：核心功能（2-3周）
- [ ] 自定义创建打卡功能
- [ ] 打卡日历
- [ ] 打卡提醒功能
- [ ] 统计数据展示
- [ ] 打卡记录管理（编辑、删除）
- [ ] 首页优化

#### 第三阶段：社交功能（2-3周）
- [ ] 动态广场
- [ ] 发布动态
- [ ] 点赞、评论功能
- [ ] 关注/粉丝功能
- [ ] 分享功能（生成分享图片）
- [ ] 用户主页

#### 第四阶段：数据驱动与优化（1-2周）
- [ ] 数据统计接口对接
- [ ] 模板推荐算法
- [ ] 模板使用数据分析
- [ ] 成就系统
- [ ] 排行榜

#### 第五阶段：优化与测试（1-2周）
- [ ] 性能优化
- [ ] UI/UX 优化
- [ ] 兼容性测试
- [ ] Bug 修复
- [ ] 用户体验测试

### 8.2 技术难点

#### 8.2.1 Vue 3 迁移
- **问题**：从 Vue 2 迁移到 Vue 3
- **解决方案**：
  - 使用 Composition API
  - 使用 Pinia 替代 Vuex（或使用 Vuex 4.x）
  - 更新组件库到 Vue 3 版本
  - 更新相关依赖

#### 8.2.2 打卡日历实现
- **问题**：打卡日历的展示和交互
- **解决方案**：
  - 使用日历组件库或自研
  - 支持月份切换
  - 已打卡日期标记
  - 点击日期查看打卡记录

#### 8.2.3 分享图片生成
- **问题**：生成精美的分享图片
- **解决方案**：
  - 使用 Canvas API 绘制
  - 或使用服务端生成（推荐）
  - 设计多种分享模板

#### 8.2.4 数据统计与分析
- **问题**：实时数据统计和模板优化
- **解决方案**：
  - 后端数据统计
  - 定时任务更新模板数据
  - 缓存机制优化性能

### 8.3 注意事项

1. **性能优化**：
   - 图片懒加载
   - 列表虚拟滚动（长列表）
   - 接口请求防抖/节流
   - 数据缓存

2. **用户体验**：
   - 加载状态提示
   - 错误提示友好
   - 操作反馈及时
   - 离线提示

3. **兼容性**：
   - 多端适配（微信小程序、H5）
   - 不同屏幕尺寸适配
   - API 兼容性处理
4. **云开发配置**：
   - `VITE_USE_WX_CLOUD`：是否开启云函数转发（默认 true）
   - `VITE_WX_CLOUD_ENV`：环境 ID（如 `prod-xxxxx`）
   - `VITE_WX_CLOUD_FUNCTION`：HTTP 网关云函数名称（默认 `stickplanet-gateway`）
   - 小程序端需在 `appId`、云环境白名单中放行对应云函数/HTTP 服务

4. **安全性**：
   - 用户数据加密
   - 接口权限验证
   - 图片上传安全校验

---

## 9. 后续规划

### 9.1 功能扩展
- 打卡群组功能
- 打卡挑战赛
- 更多打卡方式（视频、运动数据等）
- 打卡数据分析报告
- 个性化推荐算法优化

### 9.2 运营功能
- 活动运营（限时挑战、奖励活动）
- 内容运营（优质动态推荐、话题）
- 用户运营（新手引导、成长体系）

### 9.3 商业化
- 会员功能（高级模板、数据分析、无广告）
- 广告位（信息流广告）
- 模板市场（付费模板）

---

## 10. 附录

### 10.1 术语表
- **打卡**：用户完成目标后记录的行为
- **挑战**：用户创建的打卡目标
- **模板**：预定义的打卡挑战模板
- **连续打卡**：连续天数完成打卡
- **动态**：用户分享的打卡内容

### 10.2 参考资源
- UniApp 官方文档
- Vue 3 官方文档
- uView UI 文档
- 微信小程序开发文档

---

**文档版本**：v1.0  
**创建日期**：2024年  
**最后更新**：2024年

